($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/platform.rum",se:!0,d:["vendor-babel","vendor-react-libs","vendor-redux-libs","lithium-platform","ta-platform"],e:["./packages/platform/rum/rum.jsx"],m:{"./node_modules/tti-polyfill/tti-polyfill.js":function(e,t,n){(function(n){var r;!function(){var i="undefined"!=typeof window&&window===this?this:void 0!==n&&null!=n?n:this,o="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)};function a(){a=function(){},i.Symbol||(i.Symbol=u)}var s=0;function u(e){return"jscomp_symbol_"+(e||"")+s++}function c(){a();var e=i.Symbol.iterator;e||(e=i.Symbol.iterator=i.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&o(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return d(this)}}),c=function(){}}function d(e){var t=0;return function n(e){return c(),(e={next:e})[i.Symbol.iterator]=function(){return this},e}(function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}})}function l(e){c();var t=e[Symbol.iterator];return t?t.call(e):d(e)}function f(e){if(!(e instanceof Array)){e=l(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}var p=0,m="img script iframe link audio video source".split(" ");function h(e,t){for(var n=(e=l(e)).next();!n.done;n=e.next())if(n=n.value,t.includes(n.nodeName.toLowerCase())||h(n.children,t))return!0;return!1}function v(e,t){if(2<e.length)return performance.now();for(var n=[],r=(t=l(t)).next();!r.done;r=t.next())r=r.value,n.push({timestamp:r.start,type:"requestStart"}),n.push({timestamp:r.end,type:"requestEnd"});for(r=(t=l(e)).next();!r.done;r=t.next())n.push({timestamp:r.value,type:"requestStart"});for(n.sort(function(e,t){return e.timestamp-t.timestamp}),e=e.length,t=n.length-1;0<=t;t--)switch(r=n[t],r.type){case"requestStart":e--;break;case"requestEnd":if(2<++e)return r.timestamp;break;default:throw Error("Internal Error: This should never happen")}return 0}function w(e){e=e||{},this.w=!!e.useMutationObserver,this.u=e.minValue||null,e=window.__tti&&window.__tti.e;var t=window.__tti&&window.__tti.o;this.a=e?e.map(function(e){return{start:e.startTime,end:e.startTime+e.duration}}):[],t&&t.disconnect(),this.b=[],this.f=new Map,this.j=null,this.v=-1/0,this.i=!1,this.h=this.c=this.s=null,function n(e,t){var n=XMLHttpRequest.prototype.send,r=p++;XMLHttpRequest.prototype.send=function(i){for(var o=[],a=0;a<arguments.length;++a)o[a-0]=arguments[a];var s=this;return e(r),this.addEventListener("readystatechange",function(){4===s.readyState&&t(r)}),n.apply(this,o)}}(this.m.bind(this),this.l.bind(this)),function r(e,t){var n=fetch;fetch=function(r){for(var i=[],o=0;o<arguments.length;++o)i[o-0]=arguments[o];return new Promise(function(r,o){var a=p++;e(a),n.apply(null,[].concat(f(i))).then(function(e){t(a),r(e)},function(e){t(e),o(e)})})}}(this.m.bind(this),this.l.bind(this)),function i(e){e.c=new PerformanceObserver(function(t){for(var n=(t=l(t.getEntries())).next();!n.done;n=t.next())if("resource"===(n=n.value).entryType&&(e.b.push({start:n.fetchStart,end:n.responseEnd}),y(e,v(e.g,e.b)+5e3)),"longtask"===n.entryType){var r=n.startTime+n.duration;e.a.push({start:n.startTime,end:r}),y(e,r+5e3)}}),e.c.observe({entryTypes:["longtask","resource"]})}(this),this.w&&(this.h=function o(e){var t=new MutationObserver(function(t){for(var n=(t=l(t)).next();!n.done;n=t.next())"childList"==(n=n.value).type&&h(n.addedNodes,m)?e(n):"attributes"==n.type&&m.includes(n.target.tagName.toLowerCase())&&e(n)});return t.observe(document,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["href","src"]}),t}(this.B.bind(this)))}function g(e){e.i=!0;var t=0<e.a.length?e.a[e.a.length-1].end:0,n=v(e.g,e.b);y(e,Math.max(n+5e3,t))}function y(e,t){!e.i||e.v>t||(clearTimeout(e.j),e.j=setTimeout(function(){var t=performance.timing.navigationStart,n=v(e.g,e.b);if(t=(window.a&&window.a.A?1e3*window.a.A().C-t:0)||performance.timing.domContentLoadedEventEnd-t,e.u)var r=e.u;else r=performance.timing.domContentLoadedEventEnd?(r=performance.timing).domContentLoadedEventEnd-r.navigationStart:null;var i=performance.now();null===r&&y(e,Math.max(n+5e3,i+1e3));var o=e.a;(n=5e3>i-n?null:5e3>i-(n=o.length?o[o.length-1].end:t)?null:Math.max(n,r))&&(e.s(n),clearTimeout(e.j),e.i=!1,e.c&&e.c.disconnect(),e.h&&e.h.disconnect()),y(e,performance.now()+1e3)},t-performance.now()),e.v=t)}w.prototype.getFirstConsistentlyInteractive=function(){var e=this;return new Promise(function(t){e.s=t,"complete"==document.readyState?g(e):window.addEventListener("load",function(){g(e)})})},w.prototype.m=function(e){this.f.set(e,performance.now())},w.prototype.l=function(e){this.f.delete(e)},w.prototype.B=function(){y(this,performance.now()+5e3)},i.Object.defineProperties(w.prototype,{g:{configurable:!0,enumerable:!0,get:function(){return[].concat(f(this.f.values()))}}});var b={getFirstConsistentlyInteractive:function(e){return e=e||{},"PerformanceLongTaskTiming"in window?new w(e).getFirstConsistentlyInteractive():Promise.resolve(null)}};e.exports?e.exports=b:void 0===(r=function(){return b}.apply(t,[]))||(e.exports=r)}()}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/webpack/buildin/global.js":function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},"./packages/platform/rum/rum.jsx":function(e,t,n){"use strict";n.r(t);var r=n("@babel/runtime/helpers/esm/objectSpread"),i=n.n(r),o=n("@babel/runtime/helpers/esm/classCallCheck"),a=n.n(o),s=n("@babel/runtime/helpers/esm/createClass"),u=n.n(s),c=n("@babel/runtime/helpers/esm/possibleConstructorReturn"),d=n.n(c),l=n("@babel/runtime/helpers/esm/getPrototypeOf"),f=n.n(l),p=n("@babel/runtime/helpers/esm/inherits"),m=n.n(p),h=n("@babel/runtime/helpers/esm/assertThisInitialized"),v=n.n(h),w=n("@babel/runtime/helpers/esm/defineProperty"),g=n.n(w),y=n("react"),b=n("react-redux"),T=n("@ta/common.features"),_=n("@ta/common.tracking"),S=n.n(_),E=n("./node_modules/tti-polyfill/tti-polyfill.js"),x=n.n(E),k=new Set(["time-to-interactive","first-paint","first-contentful-paint","cpm-hero-latency","first-input-delay","load"]),M=function e(t,n){return{entryType:"mark",name:t,startTime:n,duration:0}},j=function e(t,n){var r=n.filter(function(e){if("resource"===e.entryType){if(Object(T.featureIsEnabled)("web_performance_rum_resource_logging")){if(e.name.includes("components/dist")||e.name.includes("assets"))return!0;if(Object(T.featureIsEnabled)("web_performance_rum_media_logging")&&function e(t){return!!t.includes("media-cdn.tripadvisor.com/media/")||!!t.includes("video-direct-tacdn-com.global.ssl.fastly.net/media/")||!!t.includes("static.tacdn.com/img2/")}(e.name))return!0}return!1}return k.has(e.name)||"measure"===e.entryType&&e.name.startsWith("ðŸ‘·")||"navigation"===e.entryType});return r.length>0?r.map(function(e){return"navigation"===e.entryType?function e(t,n){return{puid:t,name:n.name,dns:Math.round(n.domainLookupEnd-n.domainLookupStart),ttfb:Math.round(n.responseStart-n.requestStart),download:Math.round(n.responseEnd-n.responseStart),size:n.transferSize}}(t,e):"resource"===e.entryType?function e(t,n){return{puid:t,name:n.name.substring(n.name.indexOf("/","https://".length)),initiator:n.initiatorType,blocked:Math.round(n.requestStart-n.connectEnd),ttfb:Math.round(n.responseStart-n.requestStart),download:Math.round(n.responseEnd-n.responseStart),size:n.transferSize,start:Math.round(n.startTime)}}(t,e):function e(t,n){return{puid:t,name:n.name,type:n.entryType,start:Math.round(n.startTime),duration:Math.round(n.duration)}}(t,e)}):[]},L=!1,C=function(e){function t(){var e,n;a()(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return n=d()(this,(e=f()(t)).call.apply(e,[this].concat(i))),g()(v()(v()(n)),"state",{pageLoad:null,navigations:[],resources:[],timings:[]}),g()(v()(v()(n)),"addEntriesToBuffer",function(e){var t=j(n.props.uid,e);if(window.performance&&window.performance.clearResourceTimings&&window.performance.clearResourceTimings(),t.length>0){var r=t.filter(function(e){return"dns"in e}),i=t.filter(function(e){return"initiator"in e}),o=t.filter(function(e){return"duration"in e});n.setState(function(e){return{navigations:e.navigations.concat(r),resources:e.resources.concat(i),timings:e.timings.concat(o)}})}}),n}return m()(t,e),u()(t,[{key:"componentDidMount",value:function e(){var t,n,r=this;L||(L=!0,document.hidden?S()({module:"rum",action:"cannot_collect_on_inactive_tabs",context:this.props.page}):(this.setState({pageLoad:i()({},this.props,{user_agent:window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"unknown",connection_type:window.navigator&&window.navigator.connection&&window.navigator.connection.effectiveType?window.navigator.connection.effectiveType:"unknown"})}),window.performance&&window.performance.getEntries&&this.addEntriesToBuffer(window.performance.getEntries()),"undefined"!=typeof PerformanceObserver&&new PerformanceObserver(function(e){r.addEntriesToBuffer(e.getEntries())}).observe({entryTypes:["paint","resource","mark","measure"]}),x.a.getFirstConsistentlyInteractive({}).then(function(e){e&&r.addEntriesToBuffer([M("time-to-interactive",e)])}),(null===(t=window)||void 0===t?void 0:null===(n=t.perfMetrics)||void 0===n?void 0:n.onFirstInputDelay)&&window.perfMetrics.onFirstInputDelay(function(e){r.addEntriesToBuffer([M("first-input-delay",e)])}),window.navigator&&window.navigator.sendBeacon&&window.addEventListener("unload",function(){window.navigator.sendBeacon("/data/1.0/rum",JSON.stringify(r.state))},!1)))}},{key:"render",value:function e(){return null}}]),t}(y.Component);t.default=Object(b.connect)(function(e){return{uid:e.tracking.uid,page:e.route.page,locale:e.i18n.locale,revision:"".concat(e.tracking.vcsBranch,"|").concat(e.tracking.vcsRevision),is_logged_in:e.auth.isMember,viewport_category:e.meta.device.viewportCategory,is_webview:e.meta.isNativeWebview}},{})(C)}}});
//# sourceMappingURL=platform.rum.f3c8f94ede.js.map