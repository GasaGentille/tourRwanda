require(['ta/rollupAmdShim'], function(rollupAmdShim) {rollupAmdShim.install(["cpm/DesktopAds"],["page-model","ta"]);});
if(window.requirejs && requirejs.taConfig)requirejs.taConfig({"deferred":{},"name":"build/concat/desktop_ads","files":{"js-amd":{"src":{"cpm":{"DesktopAds":1}}}},"_":{"baseUrl":"/"}});
define("utils/responsive",["vanillajs"],function(){"use strict";function t(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function n(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function e(n){return function(){return t()>=n}}function r(n){return function(){return t()<=n}}function i(t,n){return function(){return e(t)()&&r(n)()}}var o={largeMonitor:1600,widescreen:1280,desktop:1024,tablet:768,mobile:767},u=Object.keys(o).sort(function(t,n){return o[n]-o[t]}),c={breakpoints:u,widths:o,atLeast:e,atMost:r,between:i,largeMonitor:e(o.largeMonitor),widescreen:e(o.widescreen),desktop:e(o.desktop),tablet:e(o.tablet),mobile:r(o.mobile),desktopOnly:i(o.desktop,o.widescreen-1),tabletOnly:i(o.tablet,o.desktop-1),landscape:function(){return t()>n()},portrait:function(){return n()>t()},currentBreakpoints:function(){return u.filter(function(t){return"function"==typeof c[t]&&c[t]()})},is:function(t,n,e){var r="function"!=typeof t&&c[t]?c[t]:t;return function(t,i){return r()?"undefined"!=typeof t?t:n:"undefined"!=typeof i?i:e}}};return c});
define("cpm/DblClickAPI",["ta/Core/TA.Store","ta/util/Error","utils/responsive"],function(e,a,t){"use strict";function r(){try{var t=e.retrieve("ads.pageTargeting")||{};for(var r in t)googletag.pubads().setTargeting(r,t[r])}catch(e){a.record(e,"DblClickAPI init: unable to add page targeting")}}function o(){var a=e.retrieve("ads.ppid");a&&googletag.pubads().setPublisherProvidedId(a)}function n(){var e=window.navigator.userAgent,a=!e||e.indexOf("Edge")===-1;return{allowOverlayExpansion:!0,allowPushExpansion:!0,sandbox:a}}var g={},i=!1,s=!1;return g.init=function(){if(window.googletag=window.googletag||{cmd:[]},s=!!e.retrieve("ads.earlyAPILoad"),!s&&!googletag.apiReady){var a=document.createElement("script");a.async=!0,a.type="text/javascript",a.src="//securepubads.g.doubleclick.net/tag/js/gpt.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(a,t)}i||(i=!0,googletag.cmd.push(function(){o(),s||(r(),googletag.pubads().setSafeFrameConfig(n())),e.has("jwplayerHelper.adUrl")&&googletag.pubads().enableVideoAds(),googletag.enableServices()}))},g});
define("utils/throttle",[],function(){return function(t,n){var e,r;return function(){r&&(clearTimeout(r),r=0);var i=e?n-(Date.now()-e):null;if(null!==i&&i>0)return void(r=setTimeout(t.apply.bind(t,this,arguments),i));var u=t.apply(this,arguments);return e=Date.now(),u}}});
define("cpm/AdController",["lib/jquery-amd","utils/throttle","ta/util/Error"],function(e,n,r){"use strict";function t(n){if(n&&n.adElem&&n.adId){if(/inactive/.test(n.adElem.className))return;var r=!1;if(f.length){for(var t=0;t<f.length;t++){var i=f[t];if(i&&i===n){r=!0;break}}r||f.push(n)}else if(f.push(n),!c){c=!0;var o=e(".scrollingModal");o&&o[0]?o[0].addEventListener("scroll",l):e(window).on("scroll",l)}}}function i(){try{for(var n=!1,t=0,i=f.length;t<i;t++){var o=f[t];o&&o.isInView()&&(o.inject(),n=!0,delete f[t])}if(n){var d=[];f.forEach(function(e){"undefined"!=typeof e&&d.push(e)}),f=d}0==f.length&&(c=!1,e(window).off("scroll",l))}catch(n){c=!1,e(window).off("scroll",l);var a=o&&o.id?o.id:"undefined",u="deferAds: Error with defer. ad ID: "+a;r.record(n,u)}}function o(){f=[]}var d={},l=n(i,150),c=!1,f=[],a=!1,u=!0;return d.deferAd=t,d.setInjectionPaused=function(e){a=e},d.injectionPaused=function(){return a},d.setInjectOnScrollUpReady=function(e){u=e},d.injectOnScrollUpReady=function(){return u},d.clearDeferred=o,d});
define("cpm/DCAdSlot",["common/trackingStreams","ta/Core/TA.Store"],function(r,t){"use strict";var e=!0,a=!0,o={};return o.define=function(o,i,n){try{var l=/^\/5349\/ta.ta/.test(o)&&Array.isArray(i)&&/^gpt-ad-/.test(n);if(!l)throw Error("invalid ad slot params: "+[].slice.call(arguments));return googletag.defineSlot(o,i,n).setForceSafeFrame(!0).addService(googletag.pubads()).setCollapseEmptyDiv(e,a)}catch(e){var s=t.has("tripads."+n)?" adId is in taStore":" adId not in taStore",d="Unable to create TripAd for target "+n+" with size "+i.map(String).join("|")+" error: "+e.message+s;r.error(d,null,null,null,"WARN")}return null},o});
define("cpm/TestSiteResolver",[],function(){"use strict";function t(){try{return window.localStorage&&!!localStorage.getItem("ads.testModeTS")}catch(t){return!1}}function e(t){return t=n.indexOf(t)!==-1?t.replace(/.s$/,".test.s"):r}function a(t){var a="string"==typeof t?t.split("/"):[];return a.length>2&&"5349"===a[1]&&(a[2]=e(a[2]),t=a.join("/")),t}var n=["ta.ta.com.s","ta.ta.ca.s","ta.ta.co.uk.s","ta.ta.cn.s"],r="ta.ta.com.test.s",s={};return s.updateAdStubs=function(t){return Array.isArray(t)&&t.forEach(function(t){t.base=a(t.base)}),t},s.timeStampFound=t,s.updateSite=e,s.updateAdBase=a,s});
define("cpm/Adomik",[],function(){"use strict";var r=5;window.Adomik=window.Adomik||{},Adomik.randomAdGroup=Adomik.randomAdGroup||function(){var r=Math.random();switch(!1){case!(r<.09):return"ad_ex"+Math.floor(100*r);case!(r<.1):return"ad_bc";default:return"ad_opt"}};var t={};return t.getAdParams=function(t){var a=!0;if(Array.isArray&&Array.isArray(t))try{a=t.toString().split(",").map(Number).sort(function(r,t){return r-t})[0]>=r}catch(r){}return a?{"ad_group":Adomik.randomAdGroup(),"ad_h":(new Date).getUTCHours().toString()}:{}},t});
define("cpm/TripAd",["lib/jquery-amd","ns-exporter","cpm/AdController","cpm/DCAdSlot","cpm/TestSiteResolver","cpm/Adomik","ta/Core/TA.Store","ta/util/Error"],function(e,r,t,n,i,a,o,d){"use strict";var c={},s=function(){return window.screen&&window.screen.orientation?window.screen.orientation.type:null},l=function(r,t){if(r&&r.tgt)try{var n=u(r);if(!n)throw new Error("unable to build refresh ad id for "+r.tgt);var i=f(r.tgt),a=i.cloneNode(!1);a.id=a.adId=n,e(a).removeClass("taEmpty"),e(a).attr("style","");var o=i.parentNode;o.replaceChild(a,i),r.tgt=n;var s=c.init(r);s.addTargeting(t),s.setInjected(),googletag.display(n)}catch(e){d.record(e,"error cloning ad for refresh")}},u=function(e){var r;try{var t=e.tgt;if(t.match(/ref\d+/)){var n=parseInt(t.match(/ref(\d+)/)[1],10)+1;r=t.replace(/ref\d+/,"ref"+n)}else r=t+"-ref1"}catch(e){d.record(e,"error building refresh ad id")}return r},f=function(e){return document.getElementById(e)||document.getElementById(e.replace(/-ref\d+/,""))};return c.init=function(r){if(!document.getElementById(r.tgt))return null;var c=function(r){var c=r,u=r.base,g=r.size,p=r.tgt,v=document.getElementById(p);i.timeStampFound()&&(u=i.updateAdBase(u));var m,h={},w=!1,y=!0,A=!1,b=!1,S=e(v).parent(".ad").height()||0,T=window.performance&&window.performance.mark?window.performance:void 0,E=function(e){try{e=_(e),e.pos&&(e.pos=j(e.pos));var r=s();window.isTabletOnFullSite&&r&&(e.oriented=/portrait/.test(r)?"p":"l"),h=e;for(var t in e)m.setTargeting(t,e[t])}catch(e){d.record(e,"error applying ad slot targeting")}},I=function(){if(v&&v.getAttribute("data-targeting")){var e=v.getAttribute("data-targeting");if(window.JSON&&JSON.parse)try{var r=JSON.parse(e.replace(/'/g,'"'));E(r)}catch(e){d.record(e,"error applying element ad targeting")}}},j=function(e){var r=[],t={"top":"a","bottom":"b"};return Array.isArray(e)?e.forEach(function(e){t[e]&&(r.push(e),r.push(t[e]))}):t[e]&&(r.push(e),r.push(t[e])),r.length?r:e},_=function(r){var t=h;for(var n in r)if(t[n]!=r[n])if("kw"!=n&&"proptype"!=n)if(t[n]){Array.isArray(t[n])||(t[n]=[t[n]]),Array.isArray(r[n])||(r[n]=[r[n]]);for(var i=t[n].concat(r[n]),a=[],o=i.length-1;o>-1;o--){var d=i.pop();e.inArray(d,a)===-1&&a.push(d)}t[n]=a.reverse()}else t[n]=r[n];else t[n]=r[n];return t},N=function(t){0==t&&(y=!1);try{var n=f(r.tgt);if(e(n).parent(".ad").add(n).hasClass("inactive"))return;if(w){if(!n)throw new Error("ad refresh fail, elem does not exist: "+p);e(n).removeClass("taEmpty"),y?googletag.pubads().refresh([m]):B()}else googletag.cmd.push(function(){T&&0===T.getEntriesByName("start_first_ad").length&&T.mark("start_first_ad"),googletag.display(p),w=!0})}catch(e){A||(d.record(e,"unable to inject TripAd for target: "+p),A=!0)}},C=function(){var e=o.retrieve("tripads."+p);e&&t.deferAd(e)},B=function(){l(c,h)},O=function(r){return r?e(r).offset().top:void 0},R=function(e){return e?e.getBoundingClientRect().top:void 0},k=function(){if(/-4x4-/.test(v.id))return!0;if(o.retrieve("ads.deferDisabled")===!0)return!0;if(t.injectionPaused())return!1;var r=f(v.id);if(r&&e(r).is(":visible")&&"hidden"!=e(r).css("visibility")){var n=e(window).scrollTop();if(b){var i=O(r);return void 0!=i&&(t.injectOnScrollUpReady()&&i+S>n)}var a=R(r);return void 0!==a&&(a>=0&&a<e(window).height())}return!1},J=function(){var r=f(v.id);if(e(r).parents(".ui_overlay").length>0)b=!1;else{var n=e(window).scrollTop(),i=O(r);b=void 0!=i&&(t.injectOnScrollUpReady()&&n>i+S)}};try{if(window["tripads."+p])m=window["tripads."+p],h=r.custom_targeting,delete window["tripads."+p];else{if(o.has("tripads."+p))throw new Error("ad slot has already been created");if(m=n.define(u,g,p),null===m){var U="TripAd.init failed with adStub: "+JSON.stringify(r);d.record(U,null,null,null,"WARN")}E(a.getAdParams(g)),r.custom_targeting&&r.custom_targeting.companion&&m.addService(googletag.companionAds()),r.custom_targeting&&E(r.custom_targeting),I()}}catch(e){return d.record("Unable to create TripAd for target "+p+": "+e.message,null,null,{},"WARN"),null}return{adId:p,adElem:v,setInjected:function(){w=!0},slotTargeting:h,addTargeting:function(e){E(e)},inject:N,refresh:B,injectWhenViewable:function(e){0==e&&(y=!1);try{J(),k()?N(y):C()}catch(e){d.record(e,"unable to inject/defer TripAd")}},defer:C,isInView:k,checkForScrollUpInjection:J}}(r);return c&&c.adId&&o.store("tripads."+c.adId,c),c},c});
define("mobile/lite/ajax-request",["utils/json-to-url","vanillajs"],function(t){function e(t){var e=document.createElement("a");return e.href=t,e.protocol!==window.location.protocol||e.host!==window.location.hostname}return function(s,o){"object"==typeof s&&(o=s,s=o.url),o=o||{};var n=o.method||o.type||"GET",r="string"==typeof o.data?o.data:t(o.data);return new Promise(function(t,a){var i=new XMLHttpRequest;i.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&(200===this.status?(o.success&&o.success(this.responseText,this.status,i),t(this.responseText)):(o.error&&o.error(i,this.status,this.statusText),a(this.responseText)),o.complete&&o.complete(i,this.statusText))},"get"==n.toLowerCase()&&"string"==typeof r&&r.length>0&&(s+=("?"==r[0]?"":"?")+r,r=null),i.open(n,s,!o.synchronous),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e(s)||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send(r)})}});
;
define("data/DynamicAdsLocation",["mobile/lite/ajax-request","page-model","ta/util/Error"],function(e,r,o){"use strict";var t={},a="/data/1.0/dynamicAdsLocationByGeo/",n="GET";return t.request=function(t,i,c,s,d,u){"number"!=typeof t&&"number"!=typeof i&&"function"!=typeof d&&"function"!=typeof u&&o.record("missing/invalid params: "+[].slice.call(arguments));var m={error:{}},f=function(e){try{var r=JSON.parse(e);d(r)}catch(e){m.error.message="Location date parse error",u(m)}},l=function(e){try{m=JSON.parse(e)}catch(e){m.error.message="Location request error"}u(m)},p={"orderId":i,"puid":c,"sessionId":s},y=r.LOC_ID||window.modelLocId;parseInt(y,10)>0&&(p.locationId=y),e({url:a+t,data:p,method:n}).then(f,l)},t});
define("babel/babel-helpers",[],function(){var e={};return e["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.jsx=function(){var e="function"==typeof Symbol&&Symbol["for"]&&Symbol["for"]("react.element")||60103;return function(r,t,n,o){var i=r&&r.defaultProps,u=arguments.length-3;if(t||0===u||(t={}),t&&i)for(var a in i)void 0===t[a]&&(t[a]=i[a]);else t||(t=i||{});if(1===u)t.children=o;else if(u>1){for(var f=Array(u),l=0;l<u;l++)f[l]=arguments[l+3];t.children=f}return{$$typeof:e,type:r,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}}(),e.asyncIterator=function(e){if("function"==typeof Symbol){if(Symbol.asyncIterator){var r=e[Symbol.asyncIterator];if(null!=r)return r.call(e)}if(Symbol.iterator)return e[Symbol.iterator]()}throw new TypeError("Object is not async iterable")},e.asyncGenerator=function(){function e(e){this.value=e}function r(r){function t(e,r){return new Promise(function(t,o){var a={key:e,arg:r,resolve:t,reject:o,next:null};u?u=u.next=a:(i=u=a,n(e,r))})}function n(t,i){try{var u=r[t](i),a=u.value;a instanceof e?Promise.resolve(a.value).then(function(e){n("next",e)},function(e){n("throw",e)}):o(u.done?"return":"normal",u.value)}catch(e){o("throw",e)}}function o(e,r){switch(e){case"return":i.resolve({value:r,done:!0});break;case"throw":i.reject(r);break;default:i.resolve({value:r,done:!1})}i=i.next,i?n(i.key,i.arg):u=null}var i,u;this._invoke=t,"function"!=typeof r["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(r.prototype[Symbol.asyncIterator]=function(){return this}),r.prototype.next=function(e){return this._invoke("next",e)},r.prototype["throw"]=function(e){return this._invoke("throw",e)},r.prototype["return"]=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new r(e.apply(this,arguments))}},"await":function(r){return new e(r)}}}(),e.asyncGeneratorDelegate=function(e,r){function t(t,n){return o=!0,n=new Promise(function(r){r(e[t](n))}),{done:!1,value:r(n)}}var n={},o=!1;return"function"==typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return this}),n.next=function(e){return o?(o=!1,e):t("next",e)},"function"==typeof e["throw"]&&(n["throw"]=function(e){if(o)throw o=!1,e;return t("throw",e)}),"function"==typeof e["return"]&&(n["return"]=function(e){return t("return",e)}),n},e.asyncToGenerator=function(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(o,i){try{var u=r[o](i),a=u.value}catch(e){return void t(e)}return u.done?void e(a):Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}},e.classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},e.createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),e.defineEnumerableProperties=function(e,r){for(var t in r){var n=r[t];n.configurable=n.enumerable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,t,n)}return e},e.defaults=function(e,r){for(var t=Object.getOwnPropertyNames(r),n=0;n<t.length;n++){var o=t[n],i=Object.getOwnPropertyDescriptor(r,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}return e},e.defineProperty=function(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e},e["extends"]=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},e.get=function e(r,t,n){null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,t);if(void 0===o){var i=Object.getPrototypeOf(r);return null===i?void 0:e(i,t,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)},e.inherits=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)},e["instanceof"]=function(e,r){return null!=r&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](e):e instanceof r},e.interopRequireDefault=function(e){return e&&e.__esModule?e:{"default":e}},e.interopRequireWildcard=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r["default"]=e,r},e.newArrowCheck=function(e,r){if(e!==r)throw new TypeError("Cannot instantiate an arrow function")},e.objectDestructuringEmpty=function(e){if(null==e)throw new TypeError("Cannot destructure undefined")},e.objectWithoutProperties=function(e,r){var t={};for(var n in e)r.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},e.possibleConstructorReturn=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r},e.selfGlobal="undefined"==typeof global?self:global,e.set=function e(r,t,n,o){var i=Object.getOwnPropertyDescriptor(r,t);if(void 0===i){var u=Object.getPrototypeOf(r);null!==u&&e(u,t,n,o)}else if("value"in i&&i.writable)i.value=n;else{var a=i.set;void 0!==a&&a.call(o,n)}return n},e.slicedToArray=function(){function e(e,r){var t=[],n=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(t.push(u.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw i}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),e.slicedToArrayLoose=function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var t,n=[],o=e[Symbol.iterator]();!(t=o.next()).done&&(n.push(t.value),!r||n.length!==r););return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},e.taggedTemplateLiteral=function(e,r){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))},e.taggedTemplateLiteralLoose=function(e,r){return e.raw=r,e},e.temporalRef=function(e,r,t){if(e===t)throw new ReferenceError(r+" is not defined - temporal dead zone");return e},e.temporalUndefined={},e.toArray=function(e){return Array.isArray(e)?e:Array.from(e)},e.toConsumableArray=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)},e});
define("common/Radio",["babel/babel-helpers"],function(e){var t={},n=/\s+/,r=function(){function t(n){e.classCallCheck(this,t),this.channel=n,this.events={},this.replies={}}return e.createClass(t,[{key:"reply",value:function(e,t,r){var i=this;return e.split(n).forEach(function(e){i.replies[e]||(i.replies[e]=[]),i.replies[e].push({callback:t,context:r||i})},this),this}},{key:"request",value:function(e){if(!this.replies[e])return null;var t=this.replies[e];t=t[t.length-1];for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.callback.apply(t.context,r)}},{key:"requestMany",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.replies[e]?this.replies[e].map(function(e){return e.callback.apply(e.context,n)}):null}},{key:"requestAll",value:function(t,n){for(var r=arguments.length,i=Array(r>2?r-2:0),u=2;u<r;u++)i[u-2]=arguments[u];if(!this.replies[t])return!0;i=[n].concat(e.toConsumableArray(i));var s="function"==typeof n?n:function(e){return e===n};return this.replies[t].reduce(function(e,t){return e&&s(t.callback.apply(t.context,i))},!0)}},{key:"requestAny",value:function(t,n){for(var r=arguments.length,i=Array(r>2?r-2:0),u=2;u<r;u++)i[u-2]=arguments[u];if(!this.replies[t])return!1;i=[n].concat(e.toConsumableArray(i));var s="function"==typeof n?n:function(e){return e===n};return this.replies[t].reduce(function(e,t){return e||s(t.callback.apply(t.context,i))},!1)}},{key:"on",value:function(e,t,r){var i=this;return e.split(n).forEach(function(e){i.events[e]||(i.events[e]=[]),i.events[e].push({callback:t,context:r||i})}),this}},{key:"once",value:function(e,t,r){var i=this;return e.split(n).forEach(function(e){i.events[e]||(i.events[e]=[]),i.events[e].push({callback:t,context:r||i,single:!0})}),this}},{key:"off",value:function(e,t){var r=this;return e.split(n).forEach(function(e){r.events[e]&&(r.events[e]=r.events[e].filter(function(e){return t&&e.callback!==t}))}),this}},{key:"trigger",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this.events[e])return this.events[e]=this.events[e].filter(function(e){return e.callback.apply(e.callback,n),!e.single}),this}},{key:"clear",value:function(){return this.events={},this.replies={},this}},{key:"requestEvery",get:function(){return this.requestAll}},{key:"requestSome",get:function(){return this.requestAny}},{key:"one",get:function(){return this.once}},{key:"emit",get:function(){return this.trigger}}]),t}();return function(e){return t[e]||(t[e]=new r(e))}});
define("cpm/HACPollingForAds6",["babel/babel-helpers","mobile/lite/ajax-request","common/Radio","common/trackingStreams"],function(e,t,i,n){function r(e,t){n.error(e,t)}function s(e){switch(e||0){case 0:return 10;case 1:case 2:case 3:case 4:return 1e3;case 5:case 6:case 7:return 1500;case 8:case 9:case 10:return 2e3;case 11:return 5e3;case 12:return 1e4;case 13:return 1e4;case 14:return 1e4;default:return-1}}function a(e,t,i){return/^\d+$/.test(e)&&t?new l(e,t,i):void r(null,"a locationId and providerSet must be provided")}var o="/data/1.0/dynamicAdsHotelPricing/",u="GET",c=new i("hotel_pricing_for_ads"),l=function(){function i(t,n,r){e.classCallCheck(this,i),this._requestedLocation=t,this._providerSet=n,this._timeStamp=r,this._pageUrl=o+t,this._requestNum=0,this._timeoutIndex=0,this._ajaxPending,this._queueRequest()}return e.createClass(i,[{key:"_queueRequest",value:function(){var e=s(this._timeoutIndex++),t=this;e>=0&&window.setTimeout(function(){t._ajaxRequest(t._requestNum++)},e)}},{key:"_ajaxRequest",value:function(e){if(!this._ajaxPending){var i={reqNum:this._requestNum,providerSet:this._providerSet};this._ajaxPending=t({url:this._pageUrl,data:i,method:u}).then(this._onSuccess.bind(this),this._onError.bind(this))}}},{key:"_onError",value:function(e){r(null,"Polling request failed for location:"+this._requestedLocation)}},{key:"_onSuccess",value:function(e){var t=" location: "+this._requestedLocation+" providers:"+this._providerSet,i=this._requestedLocation,n=this._providerSet,s=this._timeStamp,a=this._requestNum,o={locationId:i,providerSet:n,msgTimeStamp:s,pollingRequests:a};try{this._ajaxPending=null;var u=JSON.parse(e);if(!u||u.constructor!==Array)throw"Endpoint did not return an Array";var l=u.filter(function(e){return e.displayPrice}),d=u.filter(function(e){return e.isDone});0==u.length?c.emit("polling-complete",o):l.length?(Object.assign(o,l[0]),c.emit("polling-complete",o)):d.length?c.emit("polling-complete",o):this._queueRequest()}catch(e){c.emit("polling-complete",o),r(e,"Dynamic Ads: handling hac response for"+t)}}}]),i}();return{"requestPricing":a}});
define("common/ViewabilityModule",["babel/babel-helpers","ta","ta/Core/TA.Store","common/trackingStreams"],function(e,t,n,i){"use strict";function r(e,n,i){var r=n?n+"s|":"",o=r+e.containerId;o+=e.options.recordAttr.length>0?"|"+e.options.recordAttr:"",n&&t.trackEventOnPage(e.options.recordPageProperties,e.options.recordAction,o,0,!0),E&&console.log(b+","+e.containerId+","+r+","+i)}function o(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}function a(e){return e?e.replace(/[H|h]idden/,"")+"visibilitychange":null}function c(){return!!T&&!document[T]}function l(e){if(d(e))r(e,null,"in view"),e.containerInView||(e.containerInView=!0,e.currentStartTime=(new Date).getTime()),E&&(e.containerElem.style.cssText+="border: 1px solid red");else{if(r(e,null,"NOT in view"),e.containerInView){e.containerInView=!1;var t=(new Date).getTime(),n=t-e.currentStartTime;e.activeTimeSpans.push(n)}E&&(e.containerElem.style.cssText=e.containerElem.style.cssText.replace("border: 1px solid red","border: none"))}}function s(e){var t=(new Date).getTime();if(c())e.containerInView&&(e.currentStartTime=t),r(e,null,"user returned to page, total seconds so far: "+h(e)+"s"),e.checkForDataInterval=window.setInterval(function(){f(e)},e.options.checkForDataMS);else{if(e.containerInView){var n=t-e.currentStartTime;e.activeTimeSpans.push(n)}window.clearInterval(e.checkForDataInterval),r(e,null,"user left page, time spent so far: "+h(e)+"s")}}function u(e){var t=0;if(e&&e.containerElem){var n=e.containerElem.offsetHeight;t=Math.floor(n*e.options.viewableHeightPct)}return t}function d(e){if(e&&e.containerElem){if(0===e.viewableHeightPx)return e.viewableHeightPx=u(e),!1;var t=e.containerElem.getBoundingClientRect(),n=(window.pageYOffset,window.innerHeight);if(e.containerElem.offsetHeight<n){var i=t.top+e.viewableHeightPx;return i>0&&i<n}return n>t.top+H&&0<t.bottom-H}return!1}function h(e){var t=0;return e.activeTimeSpans.forEach(function(e){t+=e}),Math.floor(t/1e3)}function f(e){if(e.options.trackIntervals.length){var t=0;e.containerInView&&(t=Math.floor(((new Date).getTime()-e.currentStartTime)/1e3));var n=h(e)+t,i=e.options.trackIntervals[0];n>=i&&(r(e,i,"sending tracking for "+i+" seconds"),e.options.trackIntervals.shift())}else window.clearInterval(e.checkForDataInterval),window.removeEventListener("scroll",e.scrollHandler),document.removeEventListener(k,e.stateHandler)}function v(t,n){if(t&&"object"==("undefined"==typeof t?"undefined":e["typeof"](t))&&n&&"object"===("undefined"==typeof n?"undefined":e["typeof"](n)))for(var i in n)n.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(t[i]=n[i])}function w(e){var t=e.replace(/[\#,\.,\>,\:]/g," "),n=t.split(" ");return"vw_"+n[n.length-1]}var m={},p=!1,g=[],b="VWBLTY",I="in_view",E=!1,H=300,T=void 0,k=void 0,y=function(){function t(n,i){e.classCallCheck(this,t),this.options={viewableHeightPct:.5,checkForDataMS:2e3,trackIntervals:[1,2,5,10,15,30,45,60,75,90,105,120,150,180,300,600,900],recordAttr:"",recordAction:I,recordPageProperties:b},this.checkForDataInterval=null,this.activeTimeSpans=[0],this.containerId=null,this.containerElem=null,this.viewableHeightPx=0,this.scrollHandler=null,this.stateHandler=null,this.currentStartTime=null,this.containerInView=!1,this.init(n,i)}return e.createClass(t,[{key:"init",value:function(e,t){var n=this;try{if(T&&(v(this.options,t),this.containerElem=document.querySelector(e),this.containerElem)){this.containerId=w(e);var o=this.containerElem.offsetHeight;this.viewableHeightPx=Math.floor(o*this.options.viewableHeightPct),d(this)?(this.currentStartTime=(new Date).getTime(),this.containerInView=!0,r(this,null,"In view start timer")):r(this,null,"Not in view"),this.scrollHandler=function(){l(n)},window.addEventListener("scroll",this.scrollHandler),this.stateHandler=function(){s(n)},document.addEventListener(k,this.stateHandler),this.checkForDataInterval=window.setInterval(function(){f(n)},this.options.checkForDataMS)}}catch(e){i.error(e,"Unable to create Viewable for target "+this.containerId)}}},{key:"disable",value:function(){window.removeEventListener("scroll",this.scrollHandler),document.removeEventListener(k,this.stateHandler),window.clearInterval(this.checkForDataInterval)}}]),t}();return m.init=function(){if(!p&&(p=!0,T=o(),T&&document.body.getBoundingClientRect)){k=a(T);var e=n.retrieve("viewabilityModule.itemSelectors")||[];e.forEach(function(e){var t=new y(e);_viewabilityTrackers.push(t)})}},m.enableDebug=function(e){E=!!e},m.getTotals=function(){var e=_taRetrieve("vwblty.data")||{};for(var t in e)e.hasOwnProperty(t)&&console.log(t+":"+e[t])},m.createPostInitViewable=function(e,t){if(e){var n=new y(e,t);if(n.containerElem)return g.push(n),!0}return!1},m.tryDisableActiveViewables=function(e){var t=g.filter(function(t){return e(t.containerElem.id)}),n=g.filter(function(t){return!e(t.containerElem.id)});return g=n,t.forEach(function(e){return e.disable()}),t.length},m});
define("cpm/AdMessager",["data/DynamicAdsLocation","cpm/HACPollingForAds6","common/Radio","common/trackingStreams","common/ViewabilityModule","ta/Core/TA.Event"],function(a,e,t,i,d,r){"use strict";var n=0===location.pathname.indexOf("/vpages/dynamic_ads"),s=n?"https://"+location.hostname:"https://tpc.googlesyndication.com",o="dynads",c="genads",m="natads",g=/gptAd/,l=!1,f=/-ref[0-9]*/,u=new t("hotel_pricing_for_ads");u.on("polling-complete",function(a){v(a)});var p=function(a){if(a&&a.domId){var e=a.domId.replace(f,""),t=d.tryDisableActiveViewables(function(a){return a.replace(f,"")===e});t>1&&i.error("Ad refresh resulted in unusual amount of ads being disabled. The number was: "+t)}},y=function(){l||(d.init(),r.on("onAdRender",p))},v=function(a,e){e&&(a[e]=!0);for(var t=document.querySelectorAll('iframe[src^="'+s+'"]'),i=0;i<t.length;i++){var d=t[i];a.adInView=A(d),a.iframeId=d.id,d.contentWindow.postMessage(a,s)}},A=function(a){var e=!1;if(a.getBoundingClientRect){var t=a.getBoundingClientRect(),i=t.top>=0&&t.top+a.offsetHeight<=window.innerHeight,d=t.left>=0&&t.left+a.offsetWidth<=window.innerWidth;e=i&&d}return e},q=function(a){for(var e=document.querySelectorAll('iframe[src^="'+s+'"]'),t=0;t<e.length;t++){var i=e[t],d={dynamicAdsIdentifyForCollapsing:!0,iframeId:i.id,msgTimeStamp:a};i.contentWindow.postMessage(d,s)}},S=function(a){a.classList?a.classList.add("taEmpty"):a.className=a.className.replace(g,"gptAd taEmpty")},I=function(a,e){q(a.msgTimeStamp),i.error(e)},T={};return T.handleDynamicAdRequests=function(){window.addEventListener("message",function(t){if(t.origin==s){var r="",n="";if(require.defined("page-model")){var m=require("page-model");r=m.session&&m.session.uid,n=m.session&&m.session.sessionId}if(t.data.dynamicAdsLocationRequest)if(t.data.geoId&&t.data.orderId&&t.data.msgTimeStamp){var l=function(a){a.msgTimeStamp=t.data.msgTimeStamp,v(a,"dynamicAdsLocationRequest")},f=function(a){var e=a.error.message+" geoId:"+t.data.geoId+" orderId:"+t.data.orderId;I(t.data,e)};a.request(t.data.geoId,t.data.orderId,r,n,l,f)}else i.error("dynamicAdsLocationRequest, missing request data:"+JSON.stringify(t.data));else if(t.data.dynamicAdsAirlineRequest)if(t.data.geoId&&t.data.orderId&&t.data.origCode&&t.data.destCode&&t.data.msgTimeStamp){var l=function(a){a.msgTimeStamp=t.data.msgTimeStamp,v(a,"dynamicAdsAirlineRequest")},f=function(a){var e=a.error.message+" orderId:"+t.data.orderIdId+" origCode:"+t.data.origCode+" destCode:"+t.data.destCode;I(t.data,e)};require(["trjs!data/DynamicAdsAirline"],function(a){a.request(t.data.geoId,t.data.orderId,t.data.origCode,t.data.destCode,r,n,l,f)})}else i.error("dynamicAdsAirlineRequest, missing request data:"+JSON.stringify(t.data));else if(t.data.dynamicAdsOtaRequest)if(t.data.geoId&&t.data.orderId&&t.data.msgTimeStamp){var l=function(a){a.msgTimeStamp=t.data.msgTimeStamp,v(a,"dynamicAdsOtaRequest")},f=function(a){var e=a.error.message+" geoId:"+t.data.geoId+" orderId:"+t.data.orderId;I(t.data,e)};require(["trjs!data/DynamicAdsOta"],function(a){a.request(t.data.geoId,t.data.locationId,t.data.orderId,r,n,l,f)})}else i.error("dynamicAdsOtaRequest, missing request data:"+JSON.stringify(t.data));else if(t.data.dynamicAdsIdentifyForCollapsing)if(t.data.iframeId&&t.data.timeStampVerified){var u=document.getElementById(t.data.iframeId);if(u)for(;u.parentNode;)if(u=u.parentNode,g.test(u.className)){S(u);break}}else i.error("dynamicAdsIdentifyForCollapsing, missing request data:"+JSON.stringify(t.data));else if(t.data.hotelPricingRequest)if(t.data.locationId&&t.data.providerSet&&t.data.msgTimeStamp){e.requestPricing(t.data.locationId,t.data.providerSet,t.data.msgTimeStamp)}else i.error("hotelPricingRequest, missing request data:"+JSON.stringify(t.data));else if(t.data.otaPricingRequest)t.data.isSinglePrice&&t.data.providerSet&&t.data.msgTimeStamp?require(["cpm/OTACachedPricingForAds"],function(a){a.requestPricing(t.data.hotelSet,t.data.providerSet,t.data.msgTimeStamp)}):t.data.hotelSet&&t.data.providerSet&&t.data.msgTimeStamp?require(["cpm/OTAMultiHotelPricingForAds"],function(a){a.requestPricing(t.data.hotelSet,t.data.providerSet,t.data.msgTimeStamp)}):i.error("otaPricingRequest, missing request data:"+JSON.stringify(t.data));else if(t.data.airlinePricingRequest)t.data.airlineId&&t.data.origCode&&t.data.destCode&&t.data.msgTimeStamp?require(["cpm/AirlinePricingForAds"],function(a){a.requestPricing(t.data.airlineId,t.data.origCode,t.data.destCode,t.data.msgTimeStamp)}):i.error("airlinePricingRequest, missing request data:"+JSON.stringify(t.data));else if(t.data.dynamicAdsTrackingRequest){if(t.data.iframeId){var p=document.getElementById(t.data.iframeId);if(p&&p.classList&&p.parentNode.classList.add("taDynamic"),"impression"===t.data.action&&p.closest){var y=p.closest(".gptAd, .inline_ad_wrapper");if(y&&y.id){var A={recordAttr:t.data.context,recordAction:"ad_in_view",recordPageProperties:o};d.createPostInitViewable("#"+y.id,A)||i.warn("dynamicAdsTrackingRequest, logging impression, but failed to set up viewability tracker"+ +JSON.stringify(t.data))}else i.error("dynamicAdsTrackingRequest, logging impression, but found no parent with adInner class. Viewability tracking will fail:"+JSON.stringify(t.data))}}if(t.data.action&&"boolean"==typeof t.data.noninteraction){var T=t.data.context||"",R=t.data.value||0;i.trackEvent(o,t.data.action,T,R,t.data.noninteraction)}else i.error("dynamicAdsTrackingRequest, missing request data:"+JSON.stringify(t.data))}else if(t.data.dynamicAdsError)if(t.data.action){var T=t.data.context||"",R=t.data.value||0,N="DynamicAds:"+t.data.action+" loc:"+R+" context:"+T;i.error(N),i.trackEvent(o,t.data.action,T,R,!0),t.data.msgTimeStamp&&q(t.data.msgTimeStamp)}else i.error("dynamicAdsError, missing request data:"+JSON.stringify(t.data));else if(t.data.genericAdsTrackingRequest)if(t.data.action&&"boolean"==typeof t.data.noninteraction){var T=t.data.context||"",R=t.data.value||0;i.trackEvent(c,t.data.action,T,R,t.data.noninteraction)}else i.error("genericAdsTrackingRequest, missing request data:"+JSON.stringify(t.data))}},!1)},T.handleNativeAdRequests=function(){window.addEventListener("message",function(a){if(a.origin==s)if("NativeAdsTracking"===a.data.messageType)if(a.data.action){var e=a.data.context||"",t=a.data.value||0;i.trackEvent(m,a.data.action,e,t,!0)}else i.error("nativeAdsError, missing request data:"+JSON.stringify(a.data));else if("NativeAdsError"===a.data.messageType)if(a.data.action){var e=a.data.context||"",t=a.data.value||0,d="NativeAds:"+a.data.action+" context:"+e;i.error(d),i.trackEvent(m,a.data.action,e,t,!0)}else i.error("nativeAdsError, missing request data:"+JSON.stringify(a.data))},!1)},y(),T});
define("ta/Core/TA.PageVisibility",["vanillajs"],function(e){"use strict";function n(){a=!1;for(var e in s)s.hasOwnProperty(e)&&s[e]()}function t(){a=!0;for(var e in f)f.hasOwnProperty(e)&&f[e]()}function d(){var e=document[c]?f:s;for(var n in e)e.hasOwnProperty(n)&&e[n]()}function i(){"undefined"==typeof document[c]?document.addEventListener?(document.addEventListener("focus",n,!1),document.addEventListener("blur",t,!1)):(document.attachEvent("onfocus",n),document.attachEvent("onblur",t)):document.addEventListener(r,d),m=!0}function o(){"undefined"==typeof document[c]?document.removeEventListener?(document.removeEventListener("focus",n,!1),document.removeEventListener("blur",t,!1)):(document.detachEvent("onfocus",n),document.detachEvent("onblur",t)):document.removeEventListener(r,d),a=!1,m=!1}function u(e,n){var t=e.indexOf(n);return t>=0?e.splice(t,1):null}var c,r,f=[],s=[],m=!1,a=!1;return"undefined"!=typeof document.hidden?(c="hidden",r="visibilitychange"):"undefined"!=typeof document.mozHidden?(c="mozHidden",r="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(c="msHidden",r="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(c="webkitHidden",r="webkitvisibilitychange"),{addFocusListener:function(e){s.push(e),m||i()},addBlurListener:function(e){f.push(e),m||i()},removeFocusListener:function(e){e?u(s,e):s.length=0,0===s.length&&0===f.length&&o()},removeBlurListener:function(e){e?u(f,e):f.length=0,0===s.length&&0===f.length&&o()},hidden:function(){return"undefined"!=typeof document.hidden?document.hidden:a}}});
define("cpm/MWTripAd",["cpm/AdController","cpm/DCAdSlot","cpm/Adomik","ta/Core/TA.Store","ta/util/Error"],function(t,e,r,n,i){"use strict";var a={};return a.init=function(a,o){if(!document.getElementById(a.tgt))return null;var d=function(a,o){var d={startCollapsed:!0};for(var c in o)d[c]=o[c];var s,l=a,g=a.base,u=a.size,f=a.tgt,p=document.getElementById(f),m={},v=!1,y=!1,w=function(t){try{window.Object&&Object.assign&&(m=Object.assign(m,t));for(var e in t)s.setTargeting(e,t[e])}catch(t){i.record(t,"error applying ad slot targeting")}},b=function(t){try{var e=document.getElementById(l.tgt);if(!e)throw new Error("ad refresh fail, elem does not exist: "+f);if(e.classList.contains("inactive"))return;for(var r=e;r&&!r.classList.contains("ad");)r=r.parentElement;if(r&&r.classList.contains("inactive"))return;if(e.classList.contains("delayAd"))return;v?(e.classList.remove("taEmpty"),googletag.pubads().refresh([s])):(googletag.display(f),v=!0)}catch(t){y||(i.record(t,"unable to inject TripAd for target: "+f),y=!0)}},h=function(){var e=n.retrieve("tripads."+f);e&&t.deferAd(e)},A=function(){if(p){var t=window.getComputedStyle(p);return!!p.offsetParent&&"none"!==t&&"hidden"!==t.visibility}return!1},E=function(){var t=window.scrollTop,e=document.getElementById(p.id);return!!e&&e.getBoundingClientRect().top<t+window.offsetHeight},S=function(){if(p&&p.getAttribute("data-targeting")){var t=p.getAttribute("data-targeting");if(window.JSON&&JSON.parse)try{var e=JSON.parse(t.replace(/'/g,'"'));w(e)}catch(t){i.record(t,"error applying element ad targeting")}}};try{var T=u.map(String).indexOf("8,8")>-1&&u.map(String).indexOf("300,250")>-1;if(T)return null;if(n.has("tripads."+f))throw new Error("ad slot has already been created");if(s=e.define(g,u,f),null!==s)w(r.getAdParams(u)),S();else{var O="MWTripAd.init failed with adStub: "+JSON.stringify(a);i.record(O,null,null,null,"WARN")}}catch(t){return i.record("Unable to create TripAd for target "+f+": "+t.message),null}return{adId:f,adElem:p,slotTargeting:m,addTargeting:function(t){w(t)},inject:b,isVisible:A,isInView:E,injectWhenViewable:function(){try{E()&&A()?b():h()}catch(t){i.record(t,"unable to inject/defer MW TripAd")}}}}(a,o);return d&&d.adId&&n.store("tripads."+d.adId,d),d},a});
define("cpm/AdUtils",["ta/Core/TA.Store","common/trackingStreams","cpm/TripAd","cpm/MWTripAd"],function(t,e,r,a){"use strict";function i(e){var r=e?t.retrieve("ads."+e+".adStubs"):t.retrieve("ads.adStubs");return r&&r.adTypes?r.adTypes:null}function d(d,n,l){var c=l?a:r,g=null;if(d)try{if(d.tgt){var s="tripads."+d.tgt;if(t.has(s)){g=t.retrieve(s);var u=document.getElementById(g.adId)||document.getElementById(d.tgt.replace(/-ref\d+/,""));u&&u.id?(g.adElem=u,g.adId=g.id=u.id):g=null}else try{g=c.init(d)}catch(t){return null}}else{var o=d,f=i(n);if(f)for(var v=0;v<f.length;v++){var m=f[v];if(m.tgt&&/-ref\d+/.test(m.tgt)&&!/-ref\d+/.test(o)&&m.tgt.replace(/-ref\d+/,"")==o){var p=document.getElementById(o);p&&(p.id=o=m.tgt)}if(m.tgt===o)try{var y="tripads."+m.tgt;if(t.has(y)){g=t.retrieve(y);break}g=c.init(m);break}catch(t){return null}}}}catch(t){var h="string"==typeof d?d:d.tgt;e.error(t,"unable to get ad for id: "+h)}return g}function n(t,e,r){var a=t&&t.elemIds,i=t&&!!t.isNewContext;a&&(e(),googletag.cmd.push(function(){a.forEach(function(e){var a=document.getElementById(e);if(a){var n,l=t.modalServlet||a.getAttribute("data-ajax-servlet");n=l?d(e,l,r):d(e,void 0,r),n&&(t.targeting&&n.addTargeting(t.targeting),a.classList&&a.classList.remove("delayAd"),n.injectWhenViewable(i))}})}))}return{getAdStubs:i,getAd:d,queueForInjection:n}});
define("cpm/DesktopAds",["lib/jquery-amd","cpm/DblClickAPI","cpm/AdController","cpm/TripAd","cpm/AdMessager","cpm/TestSiteResolver","ns-exporter","utils/throttle","ta/Core/TA.Event","ta/Core/TA.Store","common/trackingStreams","ta/Core/TA.PageVisibility","common/Radio","cpm/AdUtils"],function(e,t,n,r,a,i,o,d,l,s,c,g,u,v){"use strict";function f(){l.on("ads.queueForInjection",ue),l.on("ads.injectAjaxAds",H),document.addEventListener("cpmModalDisplayRequest",p),window.isTabletOnFullSite&&e(window).on("orientationchange",D),g.addFocusListener(q),ee>0&&window.addEventListener("scroll",d(j,ne)),l.on("onOverlayClose",D),l.on("page-changes-pending",x),l.on("page-polling-complete",k),"RoadTripMap"===window.pageServlet||"RoadTripGuide"===window.pageServlet?l.on("adSizeChanged",ve):"Hotels"===window.pageServlet?(l.on("adSizeChanged",ve),l.on("responsiveAdSizeChanged",ve),l.on("adsVisibilityChanged",ve)):"Attractions"===window.pageServlet?(l.on("onAttractionFilterChange",ve),oe.on("refreshAds",ve)):"SmartDeals"===window.pageServlet?(l.on("adSizeChanged",ve),l.on("responsiveAdSizeChanged",ve)):"Restaurant_Review"===window.pageServlet?(l.on("review_filters.filter_changed",ve),l.on("review_keyword_search.tag_toggled",ve)):"ThemePark"===window.pageServlet?l.on("onHACUpdateComplete",ve):"VRACSearch"===window.pageServlet&&s.retrieve("vrDblClickAdCallsEnabled")?l.on("onVRACSearchFilterChange",ve):"Tourism"===window.pageServlet?(l.on("scrollingTabs_Start",T),l.on("scrollingTabs_End",I)):"Hotel_Review"===window.pageServlet||"Attraction_Review"===window.pageServlet||"Restaurant_Review"===window.pageServlet?(l.on("responsiveAdSizeChanged",ve),l.on("scrollingTabs_Start",T),l.on("scrollingTabs_End",I),l.on("ReviewExpanded",ve)):"Airlines"===window.pageServlet?l.on("airlinesPlacementLoad",ve):"Home"===window.pageServlet?l.on("homePageBannerRefresh",ve):"Search"===window.pageServlet?(l.on("adSizeChanged",ve),l.on("adsVisibilityChanged",ve)):"Cruises"!==window.pageServlet&&"Cruise_Review"!==window.pageServlet&&"ShowUserReviews_Cruises_Responsive"!==window.pageServlet||(m("Setting up observers for cruise."),l.on("cruiseSearchComplete",ve),l.on("responsiveAdSizeChanged",ve)),e(window).on("blur",y)}function p(e){var t=e&&e.detail;if(t&&t.modalServlet){t.targeting=t.targeting||{};var n=s.retrieve("ads."+t.modalServlet.toLowerCase()+".pageTargeting");n&&n.PageType&&(t.targeting.PageType=n.PageType)}t.isNewContext=!0,t&&t.elemIds&&v.queueForInjection(t,P)}function m(e){window.taLogDebug&&console.log(e)}function w(t){if(ge&&!le)try{if(e.inArray(t,se)>-1){le=!0,ge.mark("end_first_ad"),ge.measure("total_time_to_render","start_load_ads_js","end_first_ad"),ge.measure("ad_render_time","start_first_ad","end_first_ad");var n=ge.getEntriesByName("total_time_to_render")[0].duration,r=ge.getEntriesByName("ad_render_time")[0].duration;c.trackEvent("ad_perf","AD_LOAD_TIME",Math.floor(n)+"|"+Math.floor(r),0,!0)}}catch(e){c.trackEvent("ad_perf","AD_LOAD_FAILURE","Failed to record performance for ad in slot: "+t,!0)}}function h(t){var n=t&&t.slot?t.slot.getSlotElementId():null,r=t&&t.creativeId,a=t&&t.advertiserId;K||(K=(new Date).getTime()),w(n),Q=(new Date).getTime(),_(t),A(a,n),l.fireEvent("onAdRender",{"domId":n,"advertiserId":a,"creativeId":r}),ie&&e.inArray(window.pageServlet,ae)>-1&&(te||(te=S()),n.replace(/-ref\d+/,"")===te.replace(/-ref\d+/,"")&&(ie.addScrollHandler(),l.fireEvent("ads.lastSidebarAdInjected")));var i=e("#"+n);i.hasClass("taEmpty")||i.parent(".ad").addClass("loaded")}function A(t,n){n&&t&&t===J&&ce.indexOf(n)===-1&&e("#"+n).addClass("taEmpty")}function S(){var t=e(".scrollAdSidebar .gptAd:not(.inactive), #BODYCON .gridA .sidebar .gptAd:not(.inactive)").toArray();return t.sort(function(t,n){return t=e(t),n=e(n),t.offset().top===n.offset().top?0:t.offset().top<n.offset().top?1:-1}),t.length?t[0].id:null}function _(t){try{if(t&&t.slot&&t.creativeId){var n=e("#"+t.slot.getSlotElementId());n.attr("data-creative-id",t.creativeId),n.attr("data-advertiser-id",t.advertiserId),n.on("mouseout",function(){document.activeElement&&"IFRAME"==document.activeElement.tagName&&top.focus()})}}catch(e){}}function y(t){document.activeElement&&"IFRAME"==document.activeElement.tagName&&0===document.querySelectorAll('.ui_overlay iframe[src*="tripadvisor"]').length&&(require(["trjs!retargeting/listeners/desktop-display-adclick"],function(t){var n=e(document.activeElement).closest(".gptAd");if(n.length){var r={"slot":n.attr("id"),"creativeId":n.data("creativeId"),"advertiserId":n.data("advertiserId")};t(r)}}),e(".date_picker_modal").each(function(e,t){t.overlay&&t.overlay.hide()}))}function T(){n.setInjectionPaused(!0)}function I(){n.setInjectionPaused(!1)}function C(){n.setInjectOnScrollUpReady(!0),e(window).off("scroll",C)}function b(){var t=0;if(window.location.hash){var r=document.getElementById(window.location.hash);if(r){var a=e(r).offset().top;if(a>0&&(t=s.has("scrollingTabs.scrollOnPageLoad")?s.retrieve("scrollingTabs.scrollOnPageLoad"):a,t>0)){var i=e(window).scrollTop();0==i&&(n.setInjectOnScrollUpReady(!1),e(window).on("scroll",C))}}}return t}function E(t,n){var r=!1;if(t){if(r=!0,e(t).parent(".ad.inactive").length)return!1;if(n&&n.slotTargeting&&n.slotTargeting.disable_event_refresh)return!1}return r}function R(t){if(t){var n=e(t.adElem);n.length&&t.injectWhenViewable(!1)}}function j(){var e=(new Date).getTime();e-Q>ee&&(m("timed refresh!"),D()),Q=e}function x(){m("polling in progress"),re=!1}function k(){re=!0,m("polling complete"),G?(G=!1,l.queueForReady(N)):D()}function D(){re&&window.setTimeout(L,1)}function q(){var e=(new Date).getTime();e-Q>$&&(m("event refresh!"),D())}function L(){m("executing _refreshAllAds"),P(),n.clearDeferred(),ie&&te&&(ie.resetScrollAd(),te=null,l.fireEvent("ads.resetScrollingAd")),googletag.cmd.push(function(){try{var e=v.getAdStubs();if(e){var t=(new Date).getTime();K&&t-K>Z&&(googletag.pubads().updateCorrelator(),K=void 0);for(var n=0;n<e.length;n++){var r=e[n],a=document.getElementById(r.tgt)||document.getElementById(r.tgt.replace(/-ref\d+/,"")),i=v.getAd(r);a&&i&&E(a,i)&&(a.classList&&a.classList.remove("taEmpty"),R(i))}}}catch(e){c.error(e,"error refreshing all ads")}})}function F(){b();var t=v.getAdStubs();if(t&&t.length)for(var n=0;n<t.length;n++){var a=t[n];if(a.tgt){var i=document.getElementById(a.tgt);if(i&&!e(i).hasClass("delayAd"))try{var o=r.init(a);o&&(o.checkForScrollUpInjection(),o.isInView()?(se.push(o.adId),o.inject()):o.defer())}catch(e){c.error(e,"unable to create TripAd object for "+a.tgt)}}}}function N(){var e={isNewContext:!1},t=z(de);t.length&&(e.elemIds=[],t.forEach(function(t){e.elemIds=e.elemIds.concat([].map.call(document.querySelectorAll("#"+t+" .gptAd.delayAd:not(.inactive)"),function(e){return e.id}))}),e.elemIds.length&&v.queueForInjection(e,P))}function P(){W||(t.init(!1),s.retrieve("ads.holisticTracking")===!0&&require(["trjs!retargeting/listeners/desktop-display-adview"],function(e){var t=ta.retrieve("ads.adTracking")||{};e(t)}),f(),W=!0)}function M(e){return!(!e||!e.isUpdatePending)&&(!e.isUpdatePending()&&document.querySelectorAll(de).length)}function O(e){if(e&&e.dataset){for(var t=e;t.parentNode&&!t.dataset.placementName;)t=t.parentNode;return t.id&&t.dataset.placementName?t.id:null}return null}function z(e){var t=document.querySelectorAll(e),n=[];if(t.length){var r=O(t[0]);r&&n.push(r);var a=O(t[t.length-1]);a&&a!==r&&n.push(a)}return n}function U(){P();var e=document.querySelectorAll(".gptAd");if(e.length>0&&(Y||googletag.cmd.push(function(){if(googletag.pubads().addEventListener("slotRenderEnded",h),s.has("ads.prebidTestLatency")?setTimeout(function(){F()},s.retrieve("ads.prebidTestLatency")):F(),Y=!0,require.defined("ta/page")){var e=require("ta/page");M(e)&&k()}})),i.timeStampFound()){var t=parseInt(localStorage.getItem("ads.testModeTS"),10);if(t&&(new Date).getTime()-t>144e5)localStorage.removeItem("ads.testModeTS");else{var n=document.createElement("a");n.style.cssText="position:fixed; z-index:100000; bottom:10px; right:50%; transform:translateX(50%); background:rgba(200,0,0,.9); font-size:16px; text-decoration:underline; color:#fff; padding:10px; border-radius:2px;",n.href="/vpages/cpm/test.html",n.innerHTML="You are in Ads Test Mode, click to change",document.body.appendChild(n)}}}function B(e,t){var n={};n.elemIds=e,n.isNewContext=t,v.queueForInjection(n,P)}function V(e,t,n){var r={};r.servlet=e,r.selector=t,r.isNewContext=n,H(r)}function H(t){if(t&&t.servlet&&t.selector){var n=t.servlet,r=e(t.selector),a=!!t.isNewContext;r.removeClass("taEmpty"),r.css("display",""),P(),googletag.cmd.push(function(){if("string"==typeof n){var t="ads."+n.toLowerCase(),i=s.retrieve(t+".adStubs"),o=s.retrieve(t+".pageTargeting");i&&i.length&&r.length&&e.each(r,function(e,t){for(var n=!1,r=0;r<i.length;r++){var d=i[r];if(d&&d.tgt){var l=d.tgt.split("-"),s=l.slice(0,l.length-1).join("-");if(t.id.indexOf(s)>-1){d.tgt=t.id,n=d;break}}}if(n)try{var g=v.getAd(n);g&&(o&&g.addTargeting(o),g.injectWhenViewable(a))}catch(e){c.error(e,"unable to inject ajax ad for: "+n.tgt)}})}})}}var W=!1,Y=!1,G=!0,X={},J=55978451;a.handleDynamicAdRequests(),a.handleNativeAdRequests();var K,Q=(new Date).getTime(),Z=3e4,$=1e4,ee=s.retrieve("ads.timed_refresh_min")||0;m("_minTimedRefreshAllMS is "+ee);var te,ne=300,re=!0,ae=["ShowUserReviews","Attractions"],ie=ta&&ta.common&&ta.common.scrollAd,oe=u("AttractionOverviewResponsive"),de=".listing .meta_listing",le=!1,se=[],ce=["gpt-ad-2x1"],ge=window.performance&&window.performance.mark?window.performance:void 0,ue=function(e){v.queueForInjection(e,P)},ve=d(D,ne);return X.injectAjaxAds=V,X.queueForInjection=B,X.disableRefresh=function(){re=!1},X.collapseAd=function(t){t&&e(t.parentNode).parent(".gptAd").addClass("taEmpty")},X.initDoubleClick=U,o.exportTo(X,"ta.common.ads"),X});
